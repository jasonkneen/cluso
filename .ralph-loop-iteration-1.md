# Ralph Loop Iteration 1: File Explorer & Code Editor

## What Was Implemented

### 1. New Components Created

#### `components/FileTree.tsx`
- File tree component for displaying project file structure
- Features:
  - Collapsible folders
  - File/folder icons
  - Selection state
  - Dark mode support
  - Placeholder for actual file loading via Electron IPC

#### `components/CodeEditor.tsx`
- Monaco-based code editor component
- Features:
  - Syntax highlighting for 30+ languages
  - Auto-detected language from file extension
  - Save shortcut (Cmd+S / Ctrl+S)
  - Configurable theme (light/dark)
  - Line numbers, minimap
  - Word wrap, format on paste/type

#### `components/FilePanel.tsx`
- Combined file tree + code editor panel
- Features:
  - Toggles between file tree and editor views
  - Unsaved changes indicator
  - Save button with disabled state
  - Close button
  - Status bar showing filename and modification state

### 2. App.tsx Modifications

#### State Management
- Added `isFilePanelOpen` state to control panel visibility
- Added `filePanelWidth` state for panel sizing (default: 320px)

#### Toolbar Buttons (Lines ~9584-9604)
- **File Explorer Toggle**: Only visible when project is connected (`activeTab.projectPath`)
  - Icon: FolderOpen
  - Toggles file panel visibility
- **Jump to Source**: Only visible when project connected AND file panel open
  - Icon: FileCode
  - Placeholder for future source mapping feature

#### Layout Integration (Line ~10738)
- FilePanel rendered between center pane and chat sidebar
- Conditionally shown based on `isFilePanelOpen` AND `activeTab.projectPath`
- Receives project path, styling, and dark mode props

### 3. Dependencies Installed
- `@monaco-editor/react` (v4.7.0) - Monaco Editor React wrapper
- `@sinm/react-file-tree` (v1.1.1) - File tree component (not used yet, using custom tree)

## How It Works

### User Flow
1. Connect to a project (`activeTab.projectPath` is set)
2. Click **File Explorer** button in toolbar (FolderOpen icon)
3. File panel opens on the right side showing file tree
4. Click a file in the tree
5. Editor view opens showing file content
6. Edit file (unsaved indicator appears)
7. Press Cmd+S or click Save button
8. Click "← Files" to go back to tree
9. Click X to close the panel

### Source Mapping Integration Points
The architecture supports source mapping:
- `FilePanel` receives `projectPath` prop
- `FileTree` can be extended to highlight files with source map data
- `CodeEditor` can be configured to jump to specific line numbers
- "Jump to Source" button placeholder for quick navigation from preview

## ✅ COMPLETED in Iteration 2

### File System Integration
1. ✅ **File Loading**: Connected to `window.electronAPI.files.readFile`
   - `FilePanel.tsx` lines 33-52: Real file reading implementation

2. ✅ **File Saving**: Connected to `window.electronAPI.files.writeFile`
   - `FilePanel.tsx` lines 61-85: Real file writing with error handling

3. ✅ **File Tree Real Data**: Connected to `window.electronAPI.files.getTree`
   - `FileTree.tsx` lines 131-165: Real directory traversal
   - Auto-filters: `node_modules`, `.git`, `dist`, `build`, `.next`, `.cache`

### Source Mapping Integration
4. ✅ **Jump to Source**: Implemented working source jump
   - `App.tsx` lines 9598-9617: Button only shows when element has source location
   - Resolves file paths using existing `resolveSourceFilePath` function
   - Opens file panel with file + line number
   - `CodeEditor.tsx` lines 31-39: Auto-scrolls to line and highlights it

5. ✅ **Initial File/Line Support**: FilePanel accepts initial file and line
   - `FilePanel.tsx` lines 13-14, 24-25: New props
   - `FilePanel.tsx` lines 33-38: Auto-loads initial file on mount
   - `CodeEditor.tsx` line 13: Initial line prop
   - Editor reveals and focuses the target line

## TODO for Next Iteration

### Nice to Have
4. **Resize Handle**: Add draggable resize for `filePanelWidth`
5. **Source Map Integration**: Connect to existing source mapping
   - Highlight files that have source map data
   - Enable "Jump to Source" button to navigate from selected element
6. **File Search**: Add search/filter in file tree
7. **Recent Files**: Track and show recently opened files
8. **File Tabs**: Support multiple open files with tabs
9. **Git Integration**: Show git status in file tree (modified, new, etc.)

## Technical Notes

### Language Detection
`CodeEditor.tsx` includes language detection for:
- JavaScript/JSX, TypeScript/TSX
- HTML, CSS, SCSS, LESS
- Python, Ruby, Go, Rust, Java, C/C++, C#, PHP
- Markdown, JSON, YAML, TOML, XML
- Shell scripts, SQL, Dockerfile
- And more...

### Mock Data
Both `FileTree` and `FilePanel` use mock data for now:
```typescript
const mockTree: FileNode = {
  name: 'project-root',
  path: '/path/to/project',
  type: 'directory',
  children: [/* ... */]
}

const mockContent = `// File: ${filePath}\n// This is a mock file content...`
```

### Styling
Uses existing app theme system:
- `isDarkMode` prop for dark/light theme
- `panelBg` and `panelBorder` for consistent styling
- Matches existing component tree and properties panels

## Build Status
✅ Build successful (25.45s)
✅ No TypeScript errors in new components
✅ Integration with existing App.tsx complete
✅ Real file system APIs connected
✅ Source mapping working

## Testing Instructions

1. Start the app: `npm run dev` or `bun run desktop:dev`
2. Connect to a project (has `activeTab.projectPath`)
3. Click **File Explorer** button (FolderOpen icon) in toolbar
4. File tree loads from real project directory
5. Click any file to open in Monaco Editor
6. Edit file and press Cmd+S to save
7. Select an element in preview
8. If element has source location, **Jump to Source** button appears
9. Click to open file at exact line in editor

## Iteration 2 Complete

All critical functionality implemented:
- ✅ Real file tree loading via Electron API
- ✅ Real file reading via Electron API
- ✅ Real file saving via Electron API
- ✅ Source mapping integration working
- ✅ Jump to source from preview elements
- ✅ Line highlighting and scroll-to-line
- ✅ Unsaved changes tracking
- ✅ Full dark/light theme support
