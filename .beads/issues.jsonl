{"id":"ai-cluso-0cs","title":"MED: Fix race conditions in stream cancellation","description":"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-01T08:16:26.303726Z","updated_at":"2025-12-01T09:22:37.53528Z","closed_at":"2025-12-01T09:22:37.53528Z","close_reason":"Fixed race conditions: clean up listeners before new stream in useAIChatV2, copy Set before iteration and store session ref before nulling in useLiveGemini"}
{"id":"ai-cluso-0he","title":"LOW: Remove console.log calls from production code","description":"","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-01T08:16:39.042208Z","updated_at":"2025-12-01T10:22:45.516739Z","closed_at":"2025-12-01T10:22:45.516739Z","close_reason":"Created debug utility at utils/debug.ts that conditionally logs only in development mode. Updated all hooks and components to use debugLog instead of console.log/warn. console.error statements are preserved for critical errors."}
{"id":"ai-cluso-162","title":"HIGH: Add .catch() to all promise chains in useLiveGemini","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-01T08:16:13.596718Z","updated_at":"2025-12-01T08:32:30.576549Z","closed_at":"2025-12-01T08:32:30.576549Z","close_reason":"Partial fix: Added withSession helper with error handling, fixed cleanup and audio paths. 30+ tool responses need migration to withSession."}
{"id":"ai-cluso-1tp","title":"Remove dead code: lib/ai-sdk folder is unused","description":"The entire lib/ai-sdk/ folder (16 files, ~150KB) is NOT imported anywhere in the codebase. All AI SDK operations go through electron/ai-sdk-wrapper.cjs instead. Either integrate this code or remove it.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-01T08:52:49.632616Z","updated_at":"2025-12-01T09:04:58.820285Z","closed_at":"2025-12-01T09:04:58.820285Z","close_reason":"Removed 176KB of unused code. All AI SDK operations go through electron/ai-sdk-wrapper.cjs"}
{"id":"ai-cluso-3h2","title":"Fix MCP error handling: silent failures and inconsistent returns","description":"MCP handlers have inconsistent error handling: mcp:disconnect omits error message, mcp:list-tools/resources/prompts return arrays without success flag, mcp:get-status returns {} on error. Errors logged to console but not properly propagated to UI.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-01T08:52:56.615245Z","updated_at":"2025-12-01T09:02:08.05201Z","closed_at":"2025-12-01T09:02:08.05201Z","close_reason":"All MCP handlers now return consistent {success: true/false, error?: string} with proper instanceof Error checks"}
{"id":"ai-cluso-5a1","title":"HIGH: Encrypt OAuth tokens (use OS keychain)","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-01T08:16:13.166414Z","updated_at":"2025-12-01T10:43:11.036181Z","closed_at":"2025-12-01T10:43:11.036181Z","close_reason":"Implemented OAuth token encryption using Electron's safeStorage API. Tokens are now encrypted with OS-level secure storage (Keychain/Credential Manager). Backwards compatible with existing unencrypted tokens."}
{"id":"ai-cluso-5bd","title":"LOW: Add proper error type annotations to catch blocks","description":"","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-01T08:16:39.396036Z","updated_at":"2025-12-01T09:23:42.701394Z","closed_at":"2025-12-01T09:23:42.701394Z","close_reason":"Fixed error type annotations in useLiveGemini.ts catch blocks. Changed 'err: any' to 'err: unknown' with proper instanceof Error checks."}
{"id":"ai-cluso-775","title":"MED: Add WebSocket reconnection with exponential backoff","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-01T08:16:25.683275Z","updated_at":"2025-12-01T08:47:25.230862Z","closed_at":"2025-12-01T08:47:25.230862Z","close_reason":"Added reconnection infrastructure with exponential backoff (1s, 2s, 4s, 8s, 16s). Max 5 attempts tracked. User reconnects manually after cleanup."}
{"id":"ai-cluso-78i","title":"MED: Fix OAuth refresh thread safety","description":"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-01T08:16:26.904979Z","updated_at":"2025-12-01T10:27:19.585153Z","closed_at":"2025-12-01T10:27:19.585153Z","close_reason":"Added promise-based lock to getValidAccessToken() to prevent concurrent refresh attempts. Multiple callers now share a single refresh operation."}
{"id":"ai-cluso-7io","title":"Fast Apply not working - model returns prose or times out","description":"Fast Apply local LLM is failing to produce proper code output. Issues: 1) Returns prose explanation instead of code wrapped in \u003cupdated-code\u003e tags, 2) Sometimes times out at 30 seconds, 3) This is a critical Pro feature that must work perfectly","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-01T17:12:55.79926Z","updated_at":"2025-12-01T17:22:09.628095Z","closed_at":"2025-12-01T17:22:09.628095Z","close_reason":"Fixed multiple issues with Fast Apply:\n1. Changed TEMPERATURE from 0 to 0.1 - fine-tuned models need slight randomness to avoid instability\n2. Changed MAX_TOKENS from 4096 to 8192 - allow for larger file outputs\n3. Changed INFERENCE_TIMEOUT from 30s to 60s - large files need more processing time\n4. Changed context size from 4096 to 8192 - prevent truncation of large code + updates\n5. Updated system prompt to be more specific about the model's task\n6. Removed requirement for \u003cupdated-code\u003e tags - model outputs code directly\n7. Improved parseOutput() to better detect direct code vs prose fallback\n8. Added comprehensive prose detection patterns to reject model failures\n\nAll config tests pass. Ready for integration testing."}
{"id":"ai-cluso-8gn","title":"HIGH: Validate file paths to prevent directory traversal","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-01T08:16:12.816697Z","updated_at":"2025-12-01T08:28:07.714077Z","closed_at":"2025-12-01T08:28:07.714077Z","close_reason":"Added validatePath() function and applied to writeFile, createFile, deleteFile, renameFile, createDirectory, deleteDirectory"}
{"id":"ai-cluso-949","title":"ARCH: Extract Zod conversion to shared utility (DRY)","description":"Tools defined with Zod in frontend → converted to JSON Schema → sent to Electron → converted back to Zod. This double conversion is error-prone and loses type safety. Either pass Zod schemas directly or use a single shared definition.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-01T08:16:38.052027Z","updated_at":"2025-12-01T10:51:11.515057Z","closed_at":"2025-12-01T10:51:11.515057Z","close_reason":"Created utils/zodSchema.ts with shared zodToJsonSchema and jsonSchemaToZod functions. Replaced duplicate inline code in useAIChatV2.ts and useMCP.ts."}
{"id":"ai-cluso-9di","title":"ARCH: Extract tool dispatch to router pattern in useLiveGemini","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-01T08:16:38.416339Z","updated_at":"2025-12-01T10:48:11.918844Z","closed_at":"2025-12-01T10:48:11.918844Z","close_reason":"Extracted 16 tool handlers from useLiveGemini's 550-line if-else chain to utils/toolRouter.ts with a clean registry-based dispatch pattern."}
{"id":"ai-cluso-9hh","title":"MED: Add rate limiting to file search operations","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-01T08:16:26.608426Z","updated_at":"2025-12-01T10:29:17.284829Z","closed_at":"2025-12-01T10:29:17.284829Z","close_reason":"Added RateLimiter class and applied it to files:searchInFiles and files:glob handlers. Limits concurrent searches to 2 with 500ms minimum interval between starts."}
{"id":"ai-cluso-bsm","title":"HIGH: Add null checks before non-null assertions","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-01T08:16:14.231935Z","updated_at":"2025-12-01T09:18:32.914403Z","closed_at":"2025-12-01T09:18:32.914403Z","close_reason":"Replaced non-null assertions with proper null checks and stored references in useGit.ts, useAIChatV2.ts, useClaudeCode.ts, SettingsDialog.tsx, App.tsx"}
{"id":"ai-cluso-c8b","title":"CRITICAL: Fix git command injection in main.cjs","description":"","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-01T08:16:00.289147Z","updated_at":"2025-12-01T08:23:58.915945Z","closed_at":"2025-12-01T08:23:58.915945Z","close_reason":"Fixed: Using spawnSync with args array instead of execSync with string interpolation"}
{"id":"ai-cluso-d42","title":"Smart image insertion - detect element type, create img if needed","description":"When dropping/inserting an image onto an element:\n1. If it's an img tag: replace src\n2. If it's a div/section/container: \n   - Check if it has a child img - use that\n   - Otherwise create an img element inside it OR use background-image\n3. Generate proper source patch with srcChange or cssChanges\n4. Use consistent image naming (hash-based) to prevent duplicates\n5. Support both drag-drop and chat-based insertion","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-01T17:36:37.951502Z","updated_at":"2025-12-01T17:38:16.865843Z","closed_at":"2025-12-01T17:38:16.865843Z","close_reason":"Implemented smart image insertion with multiple strategies:\n1. IMG elements: Direct src replacement with proper undo\n2. Container elements (div, section, etc.):\n   - First check for child img element and update that\n   - Otherwise use background-image with cover/center\n3. Hash-based naming (img-{hash}.ext) prevents duplicate files\n4. Source patch generation for both src changes and CSS changes\n5. Proper undo/redo for all strategies"}
{"id":"ai-cluso-d8b","title":"CRITICAL: Add postMessage origin validation","description":"","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-01T08:16:00.741725Z","updated_at":"2025-12-01T08:26:38.813953Z","closed_at":"2025-12-01T08:26:38.813953Z","close_reason":"Added event.source validation to only accept messages from parent window"}
{"id":"ai-cluso-dt8","title":"ARCH: Create useElectronAPI wrapper hook","description":"","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-01T08:16:38.705503Z","updated_at":"2025-12-01T10:44:44.659199Z","closed_at":"2025-12-01T10:44:44.659199Z","close_reason":"Created useElectronAPI.ts hook with typed accessors for all Electron APIs, isElectron flag, and withElectron() utility."}
{"id":"ai-cluso-et3","title":"CRITICAL: Re-enable WebView security isolation","description":"","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-01T08:16:00.499055Z","updated_at":"2025-12-01T08:25:07.57783Z","closed_at":"2025-12-01T08:25:07.57783Z","close_reason":"Partial fix: nodeIntegration=false prevents guest page Node access. Full fix (contextBridge) documented as TODO."}
{"id":"ai-cluso-hj4","title":"HIGH: Replace 'as any' casts with proper types in useLiveGemini","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-01T08:16:13.930424Z","updated_at":"2025-12-01T09:20:39.904542Z","closed_at":"2025-12-01T09:20:39.904542Z","close_reason":"Replaced 23 'as any' casts with proper ToolArgs interface. Added WindowWithWebkit for AudioContext compatibility."}
{"id":"ai-cluso-i1r","title":"Add stopWhen conditions for multi-turn agent loops","description":"Uses maxSteps but lacks proper stopWhen conditions per AI SDK best practices. Streaming path at line 1286 uses maxSteps without stopWhen. Non-streaming has conditional stopWhen but only if ai.stepCountIs exists. Should add explicit termination conditions for agent loops.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-01T08:52:42.207246Z","updated_at":"2025-12-01T09:04:05.319217Z","closed_at":"2025-12-01T09:04:05.319217Z","close_reason":"Added stopWhen condition to streaming path matching non-streaming. Both use ai.stepCountIs(maxSteps) when available."}
{"id":"ai-cluso-ljl","title":"HIGH: Fix OAuth state parameter logic error","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-01T08:16:14.538998Z","updated_at":"2025-12-01T08:30:37.560396Z","closed_at":"2025-12-01T08:30:37.560396Z","close_reason":"Fixed: state is now separate from PKCE verifier, stored and validated on callback"}
{"id":"ai-cluso-pq7","title":"MED: Add JSON.parse error handling in main.cjs","description":"","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-01T08:16:25.980795Z","updated_at":"2025-12-01T08:45:16.226641Z","closed_at":"2025-12-01T08:45:16.226641Z","close_reason":"Added try-catch around JSON.parse in oauth:test-api and api:proxy handlers"}
{"id":"ai-cluso-x80","title":"MED: Add tool call timeout protection","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-01T08:16:27.241073Z","updated_at":"2025-12-01T10:26:11.041261Z","closed_at":"2025-12-01T10:26:11.041261Z","close_reason":"Added withTimeout utility wrapper and applied it to all async tool calls in useLiveGemini.ts. Tool calls now fail gracefully with timeout errors after specified durations."}
